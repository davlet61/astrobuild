---
import * as htmlparser2 from 'htmlparser2';
import Layout from '../layouts/Layout.astro';

const post = await fetch('https://s-glass.no/wp-json/wp/v2/posts/4995').then((res) => res.json());

const stylesRegex = /<style type="text\/css">.*?<\/style>/g;
const styles = post.content.rendered.match(stylesRegex);
// .join('')
// .replaceAll(/<style type="text\/css">|<\/style>/g, '');
const content = post.content.rendered.replace(stylesRegex, '');
const doc = htmlparser2.parseDocument(content);
console.log('ðŸš€ ~ file: example.astro ~ line 12 ~ doc', doc);
---

<script is:inline>
  const fetchData = async (url) => await fetch(url).then((res) => res.json());

  fetch('https://s-glass.no/wp-json/wp/v2/posts/4995')
    .then((res) => res.json())
    .then((post) => {
      const stylesRegex = /<style type="text\/css">.*?<\/style>/g;
      const styles = post.content.rendered
        .match(stylesRegex)
        .join('')
        .replaceAll(/<style type="text\/css">|<\/style>/g, '');

      const head = document.head || document.getElementsByTagName('head')[0];
      const docStyle = document.getElementsByTagName('style')[0];
      docStyle.textContent = docStyle.textContent.concat(styles);
    });
</script>

<Layout title={post.title.rendered}>
  <Fragment set:html={content} />
</Layout>
